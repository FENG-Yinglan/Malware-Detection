#!/usr/bin/python
#coding=utf-8
#
# @author Guanhong
#


permissions = []

i = 0
count = 0

for line in open('../data/jellybean_allmappings.txt'):
	if i == 0:
		pass
	elif i == 1:
		line = line.split(' ')
		count = int(line[0])

	i += 1
	if i == count + 2:
		i = 0
		permissions.append(count)


i = 0
for line in open('../data/benign_list_28787.txt'):
	# if i > 0:
	# 	break

	apkname = line.strip()
	api = '../data/benign_api_28787/' + apkname + '.txt'
	
	plist = []
	nlist = []

	for l in open(api):
		l = l.strip().split(',')
		index = int(l[0])
		num = int(l[1])

		for x in range(0, len(permissions)):
			if index < permissions[x]:
				if x in plist:
					nlist[plist.index(x)] += num
				else:
					plist.append(x)
					nlist.append(num)
				break
			else:
				index -= permissions[x]

	output = open('../data/benign_permission_28787/' + apkname + '.txt', 'w')
	for x in range(0, len(plist)):
		output.write(str(plist[x]) + ',' + str(nlist[x]) + '\n')

	print i
	i += 1