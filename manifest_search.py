#!/usr/bin/python
#coding=utf-8
#
# @author Guanhong
#


import os

def substring(string):
	beg = string.find('android:name') + 14
	if beg == -1:
		return ''
	string = string[beg:]
	end = string.index('"')
	return string[:end]

i = 0
for app in open('data/mudflow_list_2398.txt'):
	# if i > 0:
	# 	break
	manifest = 'data/mudflow_unpacked/' + app.strip() + '/AndroidManifest.xml'
	output = open('data/benign_manifest/' + app.strip() + '.txt', 'w')
	if os.path.exists(manifest):
		for line in open(manifest):
			if '<uses-feature' in line:
				if substring(line) != '':
					output.write('hardware:' + substring(line) + '\n')
			if '<uses-permission' in line:
				if substring(line) != '':
					output.write('permission:' + substring(line) + '\n')
			if '<activity' in line:
				if substring(line) != '':
					output.write('activity:' + substring(line) + '\n')
			if '<service' in line:
				if substring(line) != '':
					output.write('service:' + substring(line) + '\n')
			if '<provider' in line:
				if substring(line) != '':
					output.write('provider:' + substring(line) + '\n')
			if '<receiver' in line:
				if substring(line) != '':
					output.write('receiver:' + substring(line) + '\n')
			if '<action' in line and 'action.MAIN' not in line:
				if substring(line) != '':
					output.write('intent:' + substring(line) + '\n')
	if i % 1000 == 0:
		print i
	i += 1